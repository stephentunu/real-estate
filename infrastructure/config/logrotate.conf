# Logrotate configuration for Jaston Real Estate Platform
# This file manages log rotation for all daemon services to prevent disk space issues
# and maintain organized log files for debugging and monitoring.

# Django Application Logs
/home/douglas/jaston-real-estate/infrastructure/logs/django.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
    postrotate
        # Send USR1 signal to Django process to reopen log files
        systemctl reload jaston-django.service > /dev/null 2>&1 || true
    endscript
}

# Celery Worker Logs
/home/douglas/jaston-real-estate/infrastructure/logs/celery-worker.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
    postrotate
        # Restart Celery worker to reopen log files
        systemctl restart jaston-celery-worker.service > /dev/null 2>&1 || true
    endscript
}

# Celery Beat Logs
/home/douglas/jaston-real-estate/infrastructure/logs/celery-beat.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
    postrotate
        # Restart Celery beat to reopen log files
        systemctl restart jaston-celery-beat.service > /dev/null 2>&1 || true
    endscript
}

# Redis Logs
/home/douglas/jaston-real-estate/infrastructure/logs/redis.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
    postrotate
        # Send USR1 signal to Redis to reopen log files
        systemctl reload jaston-redis.service > /dev/null 2>&1 || true
    endscript
}

# Daemon Manager Logs
/home/douglas/jaston-real-estate/infrastructure/logs/daemon-manager.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
}

# Health Check Logs
/home/douglas/jaston-real-estate/infrastructure/logs/health-check.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
}

# Setup and Integration Test Logs
/home/douglas/jaston-real-estate/infrastructure/logs/setup.log {
    monthly
    missingok
    rotate 6
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
}

/home/douglas/jaston-real-estate/infrastructure/logs/integration-test-*.log {
    monthly
    missingok
    rotate 6
    compress
    delaycompress
    notifempty
    create 644 douglas douglas
}

# Global settings for all Jaston logs
/home/douglas/jaston-real-estate/infrastructure/logs/*.log {
    # Ensure logs don't grow beyond 100MB before rotation
    size 100M
    
    # Use date extension for rotated files
    dateext
    dateformat -%Y%m%d
    
    # Copy and truncate instead of moving (safer for running processes)
    copytruncate
    
    # Set proper permissions
    su douglas douglas
}